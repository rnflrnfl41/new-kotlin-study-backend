<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Ramtech QMS</title>

    <!--Bootstrap 필수-->
    <link href="bootstrap/css/bootstrap.min.css" rel="stylesheet" />
    <link rel="stylesheet" href="bootstrap/css/bootstrap-datepicker3.css">

    <!--Wijmo 필수-->
    <link href="wijmo/styles/wijmo.min.css" rel="stylesheet" />
    <script src="wijmo/scripts/vendor/controls/wijmo.min.js"></script>

    <!--Wijmo 컨트롤-->
    <script src="wijmo/scripts/vendor/controls/wijmo.nav.min.js"></script>
    <script src="wijmo/scripts/vendor/controls/wijmo.input.min.js"></script>
    <script src="wijmo/scripts/vendor/controls/wijmo.grid.min.js"></script>
    <script src="wijmo/scripts/vendor/controls/wijmo.grid.search.min.js"></script>
    <script src="wijmo/scripts/vendor/controls/wijmo.grid.filter.min.js"></script>
    <script src="wijmo/scripts/vendor/controls/wijmo.grid.xlsx.min.js"></script>
    <script src="wijmo/scripts/vendor/controls/wijmo.xlsx.min.js"></script>
    <script src="wijmo/scripts/vendor/controls/wijmo.chart.min.js"></script>
    <script src="wijmo/scripts/vendor/controls/wijmo.chart.annotation.min.js"></script>
    <script src="wijmo/scripts/vendor/controls/jszip.min.js"></script>
    <script src="wijmo/scripts/vendor/controls/wijmo.grid.cellmaker.min.js"></script>
    <script src="wijmo/scripts/vendor/controls/wijmo.viewer.min.js"></script>
    <script src="wijmo/scripts/vendor/controls/wijmo.pdf.min.js"></script>
    <script src="wijmo/scripts/vendor/controls/wijmo.chart.interaction.min.js"></script>
    <script src="wijmo/scripts/vendor/controls/wijmo.grid.sheet.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.15.5/xlsx.full.min.js"></script>
    <script src="wijmo/scripts/vendor/controls/wijmo.undo.min.js"></script>

    <!-- i18next CDN -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/i18next/23.10.0/i18next.min.js"></script>

    <!-- Decimal.js CDN -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/decimal.js/10.4.3/decimal.min.js" integrity="sha512-WWzCZDQZ23GuPVKPowBGCF6MhoA1az8iJk/Gjh2a5S3jeeNEvKJHgGPMyDofeUtcOeHeI3AbsPFUILWHfoRP8w==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>

    <!-- SweetAlert2 CDN -->
    <script src="https://fastly.jsdelivr.net/npm/sweetalert2@10"></script>

    <!-- html2canvas JS -->
    <script src="js/html2canvas.min.js"></script>
    <script src="js/Stack.js"></script>

    <!-- WebSocket -->
    <script src="js/sockjs.js"></script>
    <script src="js/stomp.js"></script>

    <!-- exceljs -->
    <script src="https://cdn.jsdelivr.net/npm/exceljs@4.3.0/dist/exceljs.min.js"></script>

    <!-- docxtemplater -->
    <script src="https://cdn.jsdelivr.net/npm/pizzip@3.1.7/dist/pizzip.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/docxtemplater@3.55.6/build/docxtemplater.min.js"></script>

    <!-- 아이콘 CSS -->
    <link href='https://unpkg.com/boxicons@2.1.1/css/boxicons.min.css' rel='stylesheet'>

    <link href="css/common-treeview.css" rel="stylesheet" />
    <link href="css/icon.css" rel="stylesheet" />
    <link href="css/tabscroll.css" rel="stylesheet" />
    <link href="css/rawMat.css" rel="stylesheet" />
    <link href="css/spinner.css" rel="stylesheet" />
    <link href="css/colors.css" rel="stylesheet" />

    <script src="js/Delegate.js"></script>
    <script src="js/main.js"></script>
    <script src="js/shortcutKey.js"></script>
    <script src="js/commonTool.js"></script>
    <script src="js/ColumnPicker.js"></script>
    <script src="js/OutOfControl.js"></script>
    <script src="js/Common.js"></script>
    <script src="js/Requester.js"></script>
    <script src="js/jquery.min.js"></script>
    <script src="js/jquery-ui.min.js"></script>
    <script src="jquery.splitter/js/jquery.splitter.js"></script>
    <link href="jquery.splitter/css/jquery.splitter.css" rel="stylesheet" />
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <!--Bootstrap 필수-->
    <script src="bootstrap/js/bootstrap.bundle.min.js"></script>
    <script src="bootstrap/js/bootstrap-datepicker.js"></script>
    <script src="bootstrap/js/bootstrap-datepicker.ko.min.js"></script>

    <!-- JSZip: ZIP 파일을 생성하는 라이브러리 -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.7.1/jszip.min.js"></script>
    <!-- FileSaver.js: 브라우저에서 파일을 저장하는 라이브러리. -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.5/FileSaver.min.js"></script>

    <script>
        wijmo.setLicenseKey('192.168.0.44,434314359778342#B0Kc6Jye0ICbuFkI1pjIEJCLi4TPRVEVqNERphTMXxkcshHdq9EdztGd8pVSIV4UqlXYRhGdvsyKD3Gb7B5Vo94VmhmZrRjMtlTcmR4SiNjcu5GWJFldQZ4KXhFT4FjQXhzM7REa0x6KUhmU7JFMJdXaHdFc8UmR9EWMHRmQz9GO8czMYN7QkpEbDJHOsx4a094aUFENyVmVl3yUuR6RmlXZwADRwFTN8BVUmp5QxAlUuRTTFVXR6UmN6wENOVUVzoURxg4c5Q4NBZUTwYWbRVlW4NXTnRmcBhWbNlTV9skelFlT6ljc4NXVRhWWTZldyUVdmFTaKtiMWd4NzclNDpXcVlDcwdEMwFTQwlVMTF5LhRHTLN7Mz56bUBXeGNDa8tSORlTU094SRdWc72WVMp6KBN7doFHRmNFR8ADRIR7aXhHU6dTMQFTSoNEZUFDNrIleLRDcxtUSaFGatlHatVTd7FWeysUcrZzQiojITJCLiQkN8ITQ7czMiojIIJCLyUzMxYDMxITO0IicfJye35XX3JSSwIjUiojIDJCLi86bpNnblRHeFBCI4VWZoNFelxmRg2Wbql6ViojIOJyes4nI5kkTRJiOiMkIsIibvl6cuVGd8VEIgIXZ7VWaWRncvBXZSBybtpWaXJiOi8kI1xSfis4N8gkI0IyQiwiIu3Waz9WZ4hXRgAydvJVa4xWdNBybtpWaXJiOi8kI1xSfiQjR6QkI0IyQiwiIu3Waz9WZ4hXRgACUBx4TgAybtpWaXJiOi8kI1xSfiMzQwIkI0IyQiwiIlJ7bDBybtpWaXJiOi8kI1xSfiUFO7EkI0IyQiwiIu3Waz9WZ4hXRgACdyFGaDxWYpNmbh9WaGBybtpWaXJiOi8kI1tlOiQmcQJCLiAzM5AjNwASOxMDM4IDMyIiOiQncDJCLiQDNuAjL8YTMuITOxIiOiMXbEJCLiwZhtTqisz9isTphsXKhrLiOiEmTDJCLiIDNzgzN7kTNzQTMzQzM4IiOiQWSiwSfdtlOicGbmJCLiEjdzIDMyIiOiIXZ6JCLlNHbhZIOMI');
    </script>

    <style>
        .swal2-container {
            z-index: 10000 !important;
        }

        .hideBtn {
            display: none !important ;
        }

        .header input {
            margin-right: 20px;width: fit-content;height: 30px;border: none;font-size: 20px;text-decoration: underline;
        }
        .header span {
            width: 100px;
            display: inline-block;
            margin: 5px 0;
            font-size: 22px;
            font-weight: bold;
        }

        .red-cell {
            background-color: red !important;
        }
        .yellow-cell {
            background-color: #FDFD96 !important;
            color: black !important;
        }
        .green-cell {
            background-color: #1DDB16 !important;
        }
        .orange-cell {
            background-color: #F6B99D !important;
        }
        .blue-cell {
            background-color: #50bcdf!important;
        }
        .special-pass-cell {
            background-color: #9AD756 !important;
        }


        body {
            font-size: .875rem;
        }

        .wj-tabheader {
            background: #FFFFFF;
            box-shadow: 7px -4px 20px rgba(0, 0, 0, 0.09);
            border-radius: 0px 20px 0px 0px;
        }

        .wj-tabpanel.tab-panel .wj-tabpanes {
            border: none;
        }

        .wj-tabheaders .wj-tabheader.wj-state-active {
            background: #083580 !important;
            color: #FFFFFF !important;
        }

        .wj-tabheaders .wj-tabheader.wj-state-active:after {
            display: none;
        }

        .wj-tabpanes .wj-tabpane {
            padding: 12px;
            height: calc(100vh - 116px);
        }

        .sidebar {
            position: fixed;
            top: 0;
            left: 0;
            width: 250px;
            height: 100%;
            padding: 10px 0 10px 0px;
            background: #083580;
            transition: all 0.3s ease;
            z-index: 100;
        }


        .sidebar.close {
            width: 83px;
        }

        .sidebar header {
            position: relative;
        }

        .sidebar header .image {
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .sidebar header .logo {
            width: 200px;
            opacity: 1;
            transition: all 0.3s ease;
        }

        .sidebar.close header .logo {
            opacity: 0;
        }

        .sidebar #search {
            display: flex;
            justify-content: center;

            opacity: 1;
            transition: all 0.3s ease;
        }

        .sidebar.close #search {
            display: none;

            opacity: 0;
        }

        .sidebar header .toggle{
            position: absolute;
            top: 50%;
            right: -10px;
            transform: translateY(-50%) rotate(180deg);
            height: 25px;
            width: 25px;
            background-color: rgba(0, 106, 200, 1);
            color: #FFF;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 22px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .sidebar.close .toggle{
            transform: translateY(-50%) rotate(0deg);
        }

        .sidebar.close .mc_title {
            display: block;
        }

        .sidebar .mc_title {
            display: none;
        }

        .mc_title {
            text-align: center;
            font-size: 12px;
        }

        .sidebar .sidebar-resize {
            position: absolute;
            right: -25px;
            height: 100%;
            width: 25px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 22px;
            cursor: pointer;
        }

        .sidebar .menu-bar {
            height: calc(100% - 55px);
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            overflow-y: auto;
        }

        .sidebar .menu-bar .menu {
            height: 100%;
        }

        .sidebar .wj-node-text {
            opacity: 1;
            transition: all 0.3s ease;
        }

        .sidebar.close .wj-treeview .wj-nodelist .wj-node:before {
            display: none;
            transition: all 0.3s ease;
        }

        .sidebar.close .wj-menu span {
            display: none;
        }

        .sidebar.close .wj-node-text {
            opacity: 0;
        }

        .sidebar .menu {
            margin-top: 40px;
            height: 100%;
        }

        .home {
            position: absolute;
            top: 0;
            left: 250px;
            height: 100vh;
            width: calc(100% - 250px);
            transition: all 0.3s ease;
        }

        .sidebar.close ~ .home {
            left: 83px;
            height: 100vh;
            width: calc(100% - 83px);
        }

        .btn-tab-close {
            background: none;
            border: none;
            color: inherit;
            padding: 0;
            font: inherit;
        }

        .add-btn {
            background: url("images/Add.png") no-repeat;
            background-size: cover;
            width: 60px;
            height: 60px;
            border: none;
        }

        .rtv-btn {
            background: url("images/View.png") no-repeat;
            background-size: cover;
            width: 60px;
            height: 60px;
            border: none;
        }

        .save-btn {
            background: url("images/Save.png") no-repeat;
            background-size: cover;
            width: 60px;
            height: 60px;
            border: none;
        }

        .del-btn {
            background: url("images/Delete.png") no-repeat;
            background-size: cover;
            width: 60px;
            height: 60px;
            border: none;
        }

        .home header {
            background: #FFFFFF;
            border: 1px solid #E4E4E4;
            padding: 0;
        }

        .home header .dropdown .btn {
            border: none;
            height: 60px;
        }

        #modal-background {
            position: absolute;
            z-index: 998;
            top: 0;
            bottom: 0;
            left: 0;
            right: 0;
            margin: auto;
            width: 100%;
            height: 100%;
            background-color: rgba(167, 163, 163, 0.5);
        }

        #modal-container {
            position: absolute;
            z-index: 999;
            top: 0;
            bottom: 0;
            left: 0;
            right: 0;
            margin: auto;
            border-radius: 10px;
            width: 350px;
            height: 200px;
            background-color: #f3f3f3;
            display: flex;
            flex-direction: column;
            padding: 10px;
        }

        #modal-window {
            width: 100%;
            height: 150px;
        }

        #popup-title {
            font-size: 20px;
            font-weight: bold;
        }

        #popup-content {
            margin-top: 10px;
            font-size: 15px;
        }

        #button-container {
            margin-top: auto;
            display: flex;
            flex-direction: row;
            justify-content: space-between;
        }

        #button-container button {
            width: 150px;
            height: 40px;
            border: none;
            border-radius: 5px;
            background-color: #727272;
            font-size: 15px;
            font-weight: bold;
            color: white;
        }

        .wj_popup {
        }

        .wj-popup .modal-header {
            align-items: center;
            justify-content: center;
            padding: 15px;
        }

        .wj-popup .modal-header h4 {
            font-family: 'Noto Sans KR';
            font-style: normal;
            font-weight: 700;
            font-size: 30px;
            line-height: 43px;

            color: #000000;
        }

        .wj-popup .modal-body {
            padding: 15px;
        }

        .wj-popup .modal-body label {
            font-family: 'Noto Sans KR';
            font-style: normal;
            font-weight: 400;
            font-size: 16px;
            line-height: 23px;

            color: #000000;
        }

        .wj-popup .modal-footer {
            padding: 15px;
            justify-content: center;
        }

        .wj-popup .modal-footer .wj-hide-ok {
            font-family: 'Noto Sans KR';
            font-style: normal;
            font-weight: 500;
            font-size: 20px;
            line-height: 29px;

            color: #FFFFFF;

            background: #003686;
            border-radius: 3px;

            margin-right: 10px;

            width: 180px;
            height: 50px;
        }

        .wj-popup .modal-footer .wj-hide {
            font-family: 'Noto Sans KR';
            font-style: normal;
            font-weight: 500;
            font-size: 20px;
            line-height: 29px;

            color: #003686;

            background: rgba(0, 54, 134, 0.1);
            border-radius: 3px;

            width: 180px;
            height: 50px;
        }

        .wj-popup .modal-footer .save {
            font-family: 'Noto Sans KR';
            font-style: normal;
            font-weight: 500;
            font-size: 20px;
            line-height: 29px;

            color: #FFFFFF;

            background: #003686;
            border-radius: 3px;

            margin-right: 10px;

            width: 180px;
            height: 50px;
        }

        .sidebar.close #main-top-menu .main-menu .icon, #main-bottom-menu .main-menu .icon {
            margin: 14px 14px 10px 28px;
        }

        .sidebar #main-top-menu .main-menu .icon, #main-bottom-menu .main-menu .icon {
            margin: 14px 14px 14px 28px;
        }

        .sidebar .icon {
            z-index: 1;
        }

        .sidebar.close #main-top-menu .main-menu span, .sidebar.close #main-bottom-menu .main-menu span {
            display: none;
        }

        .icon_hover {
            position: absolute;
            width: 40px;
            height: 40px;
            border-radius: 10px;
            background-color: rgba(255,255,255,0.25);
            margin-left: 20px;
            margin-top: 6px;
        }

        .sidebar .main-menu .icon_hover {
            display: none;
        }

        .sidebar.close .main-menu:not(:hover) .icon_hover {
            display: none;
        }

        .sidebar.close .main-menu:hover .icon_hover {
            display: block;
        }

        #main-top-menu .main-menu::before, #main-bottom-menu .main-menu::before {
            content: "";
            position: absolute;
            bottom: -5px;
            left: 0;
            width: 100%;
            height: 1px;
            background: linear-gradient(to right, transparent, rgba(255, 255, 255, 0.6), transparent);
        }

        .sidebar.close #main-top-menu .main-menu::before, .sidebar.close #main-bottom-menu .main-menu::before {
            display: none;
        }

        #main-top-menu .main-menu, #main-bottom-menu .main-menu {
            cursor: pointer;
            margin-bottom: 5px;
            font-weight: bold;
            color: white;
            border: none;
            position: relative;
            white-space: nowrap;
        }

        .main-menu-content {
            margin-left: 14px;
        }

        .dropdown-menu.show {
            background: #FFFFFF;
            box-shadow: 0px 4px 11px rgba(0, 0, 0, 0.1);
            border-radius: 5px;
        }

        .dropdown-menu.show li {
            text-align: center;
        }
        .wj-treeview.main-treeview {
            color: white;
            background: transparent;
            overflow-x: hidden;
            height: 100%;
        }

        /*임시 코드*/
        .sidebar.close .menu .wj-treeview.main-treeview {
            overflow-y: hidden;
        }

        .wj-treeview.main-treeview .wj-node img {
            width: 26px;
            height: 24px;
        }

        .wj-treeview.main-treeview .wj-nodelist .wj-node:not(.wj-state-empty):not(.wj-state-collapsed) {
            background-color: transparent;
            background-image: url("/images/MenuBar.png") !important;
            background-repeat: no-repeat !important;
            background-size: 100% 100px;
            font-weight: bold;
            color: #003686;
            height: 100px;
            line-height: 60px;
        }

        .wj-treeview.main-treeview .wj-nodelist .wj-node.wj-state-collapsed {
            background: transparent;
        }

        .wj-treeview.main-treeview .wj-nodelist .wj-node.wj-state-empty {
            background-color: transparent;
            font-weight: normal;
            color: rgba(255, 255, 255, 0.8);
        }

        .wj-treeview.main-treeview .wj-nodelist .wj-node:not(.wj-state-empty) {
            padding: 15px
        }

        .wj-treeview.main-treeview .wj-nodelist .wj-state-empty {
            padding-left: 15px;
            padding-right: 15px;
            margin: 5px !important;
        }

        .wj-treeview.main-treeview .wj-node.wj-node.wj-state-empty.wj-state-selected {
            font-weight: bold!important;
            color:white!important;
            background: rgba(255, 255, 255, 0.3);
            border-radius: 30px;
        }

        .menu-bar ::-webkit-scrollbar,.sidebar ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }

        .menu-bar ::-webkit-scrollbar,.sidebar ::-webkit-scrollbar-track {
            background: #083580;
            border-radius: 15px;
        }

        .menu-bar ::-webkit-scrollbar,.sidebar ::-webkit-scrollbar-thumb{
            background: #4375ce;
            border-radius: 15px;
        }

        /*::-webkit-scrollbar-button:vertical:start:decrement,
        ::-webkit-scrollbar-button:vertical:start:increment {
            height: 30px;
        }*/

        /*::-webkit-scrollbar-thumb:hover {*/
        /*    background: #083580;*/
        /*}*/

        .btn-crud {
            box-sizing: border-box;

            width: 60px;
            height: 60px;

            background: #FFFFFF;
        }

        .icon-crud {
            position: absolute;
            width: 60px;
            height: 60px;

            font-size: 24px;
            line-height: 51px;
            text-align: center;

            color: #6B6B6B;

            user-select: none;
        }

        .text-crud {
            position: absolute;
            width: 60px;
            height: 60px;

            font-family: 'Inter';
            font-style: normal;
            font-weight: 400;
            font-size: 13px;
            line-height: 96px;
            text-align: center;

            color: #979797;

            user-select: none;
        }

        #option-popup .modal-body {
            width: 800px;
        }

        #option-tabPanel .wj-tabpanes .wj-tabpane {
            height: min-content;
        }

        .main-row {
            display: flex;
            flex-direction: row;
        }

        .main-col {
            display: flex;
            flex-direction: column;
        }

        #timer {
            margin-right: 10px;
            font-size: 20px;
        }

        #refresh_button {
            margin-right: 10px;
            padding: 10px 20px;
            border-radius: 36px;
            border: none;
            background-color: #f7f7f9;
            color: #222225;
        }

        .wrapper {
            margin: 0 auto;
            width: 100%;
        }

        #theTabPanel .wj-tabheaders {
            scroll-behavior: smooth;
        }

        .rotate-icon {
            transition: transform 0.5s;
        }

        .rotate-icon:hover {
            transform: rotate(180deg);
        }

        @keyframes scroll-animation{
            0%{
                left: 0;
            }
            100%{
                left: -100px; /* 텍스트 width와 동일 */
            }
        }
        .scroll-text{
            width: 100%;
            overflow: hidden;
        }
        .track{
            position: relative;
            width: 700px;
            animation: scroll-animation 5s linear infinite;
        }
        .track p{
            float: left;
            width: 100px;
            margin-bottom: 0px;
        }

        #option-tabPanel .wj-tabpane {
            height: 375px !important;
        }

        .notify-list {
            width: 382px;
            height: 382px;
            transition: all 0.3s ease;
            bottom: 0px;
        }

        .toast-container {
            height: 334px;
            overflow-y: scroll;
            scrollbar-width: none;
            -ms-overflow-style: none;
            background-color: rgba(255, 255, 255, 0.8);
            border-left: 1px solid #E4E4E4;
            border-right: 1px solid #E4E4E4;
            padding: 1rem;
        }

        .toast-contents {
            height: 24px;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
            transition: all 0.3s ease;
        }

        .notify-btn:hover i {
            transform: scale(1.2);
        }

        .notify-btn i {
            transition: transform 0.3s;
        }

        .notify-confirm-btn {
            background-color: #1364A3FF;
            color: white;
            border: none;
            border-radius: 6px;
        }

        .notify-expand-btn {
            background-color: #F1F1F1FF;
            color: black;
            border: none;
            border-radius: 6px;
            width: 54px;
        }

        #main-search {
            background: rgba(0, 106, 200, 1);
        }

        #main-search .wj-glyph-down {
            display: none;
        }

        #main-search.wj-combobox.wj-state-focus.wj-state-focused .wj-form-control {
            color: #FFFFFF;
        }

        #main-search.wj-combobox.wj-state-collapsed {
            border: 1px solid rgba(0, 106, 200, 1);
        }

        #main-search_dropdown .wj-listbox-item {
            color: #FFFFFF;
        }
    </style>
</head>
<body>
<nav class="sidebar close">
    <div class='sidebar-resize'></div>
    <header>
        <span class="image">
            <img class="logo" src="images/MainLogo.png" alt="" style="cursor: pointer;" onclick="openDashboard();">
        </span>
        <i class='bx bx-chevron-right toggle'></i>
    </header>
    <div class="menu-bar">
        <div class="menu">
            <div id="search">
                <div id="main-search"></div>
            </div>

            <div id="main-top-menu"></div>
        </div>
        <div class="bottom-content" style="overflow-y: scroll; height: 200px;">
            <div id="main-bottom-menu"></div>
        </div>
    </div>
</nav>

<section class="home">
    <header class="navbar navbar-expand-lg justify-content-end">
        <!--<div>
            <select id="langSelect" onchange="langChanged()">
                <option value="koJson" selected>한국어</option>
                <option value="enJson">English</option>
                <option value="jaJson">Japanese</option>
            </select>
        </div>-->
        <span id="server-status" style="margin-right: 10px;"></span>
        <span id="timer">00:00:00</span>
        <button type="button" id="refresh_button" onclick="OnClickRefresh()">연장</button>

        <button type="button" class="rtv-btn" id="crudRtv" style="display: none;" title="F5"></button>
        <button type="button" class="add-btn" id="crudAdd" style="display: none;" title="F2"></button>

        <div class="btn-crud" id="crud-mod" style="display: none">
            <i class='bx bx-edit-alt icon-crud'></i>
            <div class="text-crud">Modify</div>
        </div>

        <button type="button" class="save-btn" id="crudSave" style="display: none;" title="F3"></button>
        <button type="button" class="del-btn" id="crudDel" style="display: none;" title="F4"></button>

        <div class="dropdown">
            <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false">
                <span th:text="${userName}"></span>
            </button>
            <ul class="dropdown-menu dropdown-menu-end">
                <li><a class="dropdown-item" onclick="getUserManual();">사용자 매뉴얼</a></li>
                <li><a class="dropdown-item" onclick="optionBtnClick();">환경설정</a></li>
                <li><a class="dropdown-item" style="color:brown" onclick="onClickLogout();">로그아웃</a></li>
            </ul>
        </div>
    </header>

    <div class="wrapper">
        <div id="theTabPanel"></div>
    </div>
</section>

<div id="common-popup">
    <div class="modal-header">
        <h4 class="modal-title"></h4>
        <!--<button type="button" tabindex="-1" class="close wj-hide">&times;</button>-->
    </div>
    <div class="modal-body">
    </div>
    <div class="modal-footer">
        <button type="button" class="btn wj-hide-ok">확인</button>
        <button type="button" class="btn wj-hide">취소</button>
    </div>
</div>

<div id="option-popup">
    <div class="modal-header">
        <h4 class="modal-title">환경설정</h4>
        <!--<button type="button" tabindex="-1" class="close wj-hide">&times;</button>-->
    </div>
    <div class="modal-body">
        <div class="alert alert-warning" role="alert">
            설정 후에는 새로고침을 해주세요.
        </div>
        <div id="option-tabPanel">
            <div>
                <a>일반</a>
                <div>
                    <h5>넬슨 규칙</h5>
                    <div class="form-check">
                        <input class="form-check-input" type="checkbox" value="" id="nelson-rule-1" checked>
                        <label class="form-check-label" for="nelson-rule-1">
                            넬슨 규칙 1 (관리한계 이탈)
                        </label>
                    </div>

                    <div class="form-check">
                        <input class="form-check-input" type="checkbox" value="" id="nelson-rule-2" checked>
                        <label class="form-check-label" for="nelson-rule-2">
                            넬슨 규칙 2 (9개점 이상 평균선 기준 한쪽으로 치우침)
                        </label>
                    </div>

                    <div class="form-check">
                        <input class="form-check-input" type="checkbox" value="" id="nelson-rule-3" checked>
                        <label class="form-check-label" for="nelson-rule-3">
                            넬슨 규칙 3 (6개점 이상 연속 상승 혹은 하락)
                        </label>
                    </div>

                    <div class="form-check">
                        <input class="form-check-input" type="checkbox" value="" id="nelson-rule-4" checked>
                        <label class="form-check-label" for="nelson-rule-4">
                            넬슨 규칙 4 (14개점 이상 평균선 기준 상하변동)
                        </label>
                    </div>

                    <div class="form-check">
                        <input class="form-check-input" type="checkbox" value="" id="nelson-rule-5" checked>
                        <label class="form-check-label" for="nelson-rule-5">
                            넬슨 규칙 5 (연속 3개점 중 2개 이상 동일 방향으로 2시그마 이탈)
                        </label>
                    </div>

                    <div class="form-check">
                        <input class="form-check-input" type="checkbox" value="" id="nelson-rule-6" checked>
                        <label class="form-check-label" for="nelson-rule-6">
                            넬슨 규칙 6 (연속 5개점 중 4개 이상 동일 방향으로 1시그마 이탈)
                        </label>
                    </div>

                    <div class="form-check">
                        <input class="form-check-input" type="checkbox" value="" id="nelson-rule-7" checked>
                        <label class="form-check-label" for="nelson-rule-7">
                            넬슨 규칙 7 (15개점 이상 연속 1시그마 이내)
                        </label>
                    </div>

                    <div class="form-check">
                        <input class="form-check-input" type="checkbox" value="" id="nelson-rule-8" checked>
                        <label class="form-check-label" for="nelson-rule-8">
                            넬슨 규칙 8 (8개점 이상 연속 1시그마 이탈)
                        </label>
                    </div>

                    <div>
                        <h5>소수점 자리수</h5>
                        <div style="display: flex">
                            <div id="decimal-place" style="width: 50px; text-align: right;"></div>
                            <div style="display: flex; align-items: center; margin-right: 10px;">자리 표시</div>
                            <div id="decimal-text" style="display: flex; align-items: center;"></div>
                            <div id="decimal-type" style="width: 100px;"></div>
                        </div>

                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" value="" id="decimal-valid">
                            <label class="form-check-label" for="decimal-valid">
                                유효숫자 확인
                            </label>
                        </div>
                    </div>
                    <p style="color: #FF0000">※ 소수점 수정 후 페이지를 새로 생성해야 적용됩니다.</p>

                    <div>
                        <h5>알람 팝업</h5>
                        <div id="alarm-popup-time"></div> 분
                    </div>
                    <div>
                        <h5>LOT검색</h5>
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" value="" id="lotSearchSetFormatItem">
                            <label class="form-check-label" for="lotSearchSetFormatItem">
                                색상 적용
                            </label>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="modal-footer">
        <button type="button" class="btn wj-hide-ok">확인</button>
        <button type="button" class="btn wj-hide">취소</button>
    </div>
</div>

<!--notify-list 바로 위에 버튼 추가-->
<div class="notify-btn position-fixed" style="z-index: 200;cursor: pointer; bottom: 382px; right: 0px; width: 48px; height: 48px; padding: 12px; border-top-left-radius: 10px; border-top-right-radius: 10px; background-color: #083580; font-size: 24px; color: white; transition: all 0.3s ease;">
    <i class='bx bx-bell' ></i>
</div>
<div class="notify-list position-fixed end-0" style="bottom: 0px;">
    <div class="notify-header" style="display: flex; flex-direction: row; justify-content: space-between; padding: 1rem 1rem 0rem 1rem; background-color: #083580; border-top-left-radius: 10px;">
        <h5 style="color: white;">알림</h5>
        <a style="cursor: pointer; color: white; text-decoration-line: none;" href="javascript:ClearAlarms();">모두 지우기</a>
    </div>
    <div class="toast-container">
        <div id="toastTemplate" class="toast" role="alert" aria-live="assertive" aria-atomic="true">
            <div class="toast-header">
                <strong class="me-auto toast-title"></strong>
                <button type="button" class="btn-close" data-bs-dismiss="toast" aria-label="Close"></button>
            </div>
            <div class="toast-body">
                <div class="toast-contents" style="height: 24px;"></div>
                <div class="mt-2 pt-2 border-top toast-btn-area" style="display: flex; flex-direction: row; justify-content: space-between;">
                    <button type="button" class="notify-confirm-btn toast-btn">확인</button>
                </div>
            </div>
        </div>
    </div>
</div>

<div id="requestPopup">
    <div class="modal-header" style="justify-content: space-between;">
        <h5>검사항목 추가</h5>
        <button type="button" class="btn-close" id="requestPopUpCloseBtn" onclick="requestPopupHide()"></button>
    </div>
    <div class="modal-body">
        <input name="division" type="hidden"/>
        <input name="lotNo" type="hidden"/>
        <input name="requestDivision" type="hidden"/>
        <input name="process" type="hidden"/>
        <input name="rawMatName" type="hidden"/>
        <input name="uId" type="hidden"/>
        <div style="display: flex;float: left; margin-top: 30px;">
            <div style="margin-left: 20px;">
                <span class="grid-header" style="text-align: center;margin-bottom: 3px;justify-content: center;">검사항목</span>
                <div id="requestPopupSettingList" style="width: 315px; height: 500px;"></div>
            </div>
            <div id="requestPopupAddOrDelete" style="width: 150px;align-items: center;display: grid;justify-content: center;align-content: center;margin-left: 20px;margin-right: 20px;">
                <button class="btn btn-outline-secondary" onclick="requestPopupAdd()">추가하기 >></button>
                <button class="btn btn-outline-secondary" onclick="requestPopupDelete()" style="margin-top: 10px;"><< 제거하기</button>
                <button class="btn btn-outline-secondary" onclick="requestPopupReset()" style="position: absolute;top: 500px;height: 50px;">검사항목새로고침</button>
            </div>
            <div>
                <span class="grid-header" style="text-align: center;margin-bottom: 3px;justify-content: center;">추가한 검사항목</span>
                <div id="requestPopupAddedList" style="width: 960px; height: 500px;"></div>
            </div>
        </div>
    </div>
    <div class="modal-footer">
        <button class="btn btn-outline-secondary" style="width: 100%;height:auto; margin-top: 10px;" onclick="requestPopupSave()">수정 및 저장</button>
    </div>
</div>

<div id="basicNonConformityPopup" style="width: 100%;height: 100%">
    <div class="modal-header" style="justify-content: space-between;">
        <h5>검사항목 리스트</h5>
        <button type="button" class="btn-close" onclick="basicNonConformityPopupHide()"></button>
    </div>
    <div class="modal-body">
        <div>
            <input name="lotNo" type="hidden" th:value="${lotNo}"/>
            <input name="requestDivision" type="hidden" th:value="${requestDivision}"/>
            <input name="process" type="hidden" th:value="${process}"/>
        </div>
        <div class="header" style="margin-left: 50px;margin-top: 30px; margin-bottom: 30px;float: left;display: flex;align-items: center;">
            <span class="select-span">Lot NO:</span>
            <input type="text" class="form-control" aria-describedby="rawNonDialog1" id="nonConformityPopupLotNo" readonly=true>
            <span class="select-span" id="rawNonDialog2">품명:</span>
            <input type="text" class="form-control" aria-describedby="rawNonDialog2" id="nonConformityPopupName" readonly=true>
            <span class="select-span" id="rawNonDialog3">공정:</span>
            <input type="text" class="form-control" aria-describedby="rawNonDialog3" id="basicNonConformityPopupProcess" readonly=true>
            <span class="select-span" id="rawNonDialog4">의뢰구분:</span>
            <input type="text" class="form-control" aria-describedby="rawNonDialog4" id="basicNonConformityPopupRequestDivision" readonly=true>
            <span class="select-span" id="rawNonDialog5">의뢰목적:</span>
            <input type="text" class="form-control" aria-describedby="rawNonDialog5" id="nonConformityPopupRequestPurpose" readonly=true>
        </div>
        <div id="basicNonConformityPopupGrid" style="height: 680px"></div>
    </div>
    <div class="modal-footer">
        <button class="btn btn-outline-secondary" style="width: 100%;height: auto; margin-top: 10px;" onclick="basicNonConformityPopupHide()">닫기</button>
    </div>
</div>

<input id="uName" type="hidden" th:value="${userName}"/>
<input id="uId" type="hidden" th:value="${userId}"/>
<input id="uGroup" type="hidden" th:value="${groupId}"/>
<script>

    var lotSearchColorVisibility = true;

    var requestFileUploadModal = null;

    var remarkHistoryModal = null;

    var gCheckedValue = null;
    var searchDateChooseItemsSource = ["기간선택","최근1일","최근1주","최근2주","최근1개월","최근3개월","최근6개월","최근9개월","최근1년"];

    var sidebarClose = true;

    function langChanged() {
        sessionStorage.setItem("lang",$("#langSelect option:selected").val());
        window.location.reload();
    }

    function replaceText() {
        var elements = document.querySelectorAll("[data-lang]");
        elements.forEach((el) => {
            var text = el.dataset.lang;
            if(lang == 'enJson'){
                el.textContent  = enJson[text];
            }
            else if(lang == 'koJson'){
                el.textContent  = koJson[text];
            }
            else if(lang == 'jaJson'){
                el.textContent  = jaJson[text];
            }else {
                el.textContent  = koJson[text];
            }
        });
    }

    function optionBtnClick() {
        option_popup.show(true, async (s) => {
            if (s.dialogResult == 'wj-hide-ok') {

                var param = {
                    decimalPlace : decimal_place,
                    decimalType : current_decimal_type,
                    popupAlarm : popup_alarm,
                    decimalValid : Number(decimal_valid),
                    lotSearchColorVisibility : Number(lotSearchColorVisibility),
                }

                console.log(param);

                await RequestPostAsync('/api/option/save', param, ResponseType.TEXT, () => {
                    option_save_delegate.callDelegates();
                    ResetPopupAlarms();

                    if(wijmo.Control.getControl('#product-lot-search-lot-no') !== null){
                        var seleted = wijmo.Control.getControl('#product-lot-search-lot-no').selectedItem;
                        if(seleted !== "" && seleted !== null && seleted !== undefined){
                            ProductLotSearchRtv();
                        }
                    }

                });

            }
        });
    }
    var top_menu = null;
    var bottom_menu = null;
    var currentMenu = null;

    function changeLangFromStorage(programId){
        var lang = sessionStorage.getItem("lang") == null ? "koJson" : sessionStorage.getItem("lang");
        if(lang == 'enJson'){
            return  enJson['menuBar'][programId];
        }
        else if(lang == 'koJson'){
            return  koJson['menuBar'][programId];
        }
        else if(lang == 'jaJson'){
            return  jaJson['menuBar'][programId];
        }else {
            return  koJson['menuBar'][programId];
        }
    }

    $(document).ready(async function () {

        requestFileUploadModal = new wijmo.input.Popup('#requestFileUploadModal');

        var sessionGetLang = sessionStorage.getItem("lang");
        switch(sessionGetLang) {
            case 'koJson' :
                $("#langSelect").val("koJson").prop("selected", true);
                break;
            case 'enJson' :
                $("#langSelect").val("enJson").prop("selected", true);
                break;
            case 'jaJson' :
                $("#langSelect").val("jaJson").prop("selected", true);
                break;
            default  : $("#langSelect option:selected").html("한국어");
        }

        top_menu = document.getElementById("main-top-menu");
        bottom_menu = document.getElementById("main-bottom-menu");

        // ...
        var menu = document.createElement('div');
        menu.classList.add('main-menu');
        menu.onclick = function () {
            openDashboard();
        };

        var div = document.createElement('div');
        div.classList.add('icon_hover');

        menu.appendChild(div);

        var img = document.createElement('img');
        img.classList.add('icon', 'dashboard');
        img.src = 'images/Dashboard.png';

        menu.appendChild(img);

        var span = document.createElement("span");
        span.innerText = '홈'
        menu.appendChild(span);

        top_menu.appendChild(menu);

        var title_div = document.createElement('div');
        title_div.classList.add('mc_title');
        title_div.innerText = '홈';
        menu.appendChild(title_div);
        // ...

        AddMainCategoryMenu({
            id: 'favorite',
            name: '즐겨찾기',
            order: 0,
            icon: 'favorite'
        });

        tv_favorite = new wijmo.nav.TreeView('#tree-favorite', {
            itemsSource: [],
            displayMemberPath: 'header',
            childItemsPath: 'items',
            lazyLoadFunction: lazyLoadFunction,
            isAnimated: false,
            isCollapsedChanged: function (s, e) {
                refreshIcon(s);
            },
            formatItem: function (s, e) {
                var data = e.dataItem;

                // X 버튼 추가
                var btn = document.createElement('button');
                btn.className = 'btn btn-close';
                btn.style.marginLeft = '5px';
                btn.style.width = '10px';
                btn.style.height = '10px';
                btn.style.color = '#FFFFFF !important';
                btn.addEventListener("click", function (event) {
                    flag = true;

                    sweetConfirm.fire({
                        text: '즐겨찾기에서 삭제하시겠습니까?',
                        confirmButtonText: '삭제'
                    }).then((result) => {
                        if (result.isConfirmed) {
                            fetch('/api/deleteFavorite', {
                                method: 'POST',
                                headers: {
                                    'Content-Type': 'application/json'
                                },
                                body: JSON.stringify([data.programID])
                            })
                                .then(res => res.text())
                                .then(async data => {
                                    if (data == 'success') {
                                        await fetch('/api/getFavoriteMenu')
                                            .then(res => res.json())
                                            .then(data => {
                                                var items = data.map(item => ({
                                                    header: item[3],
                                                    programID: item[2],
                                                    programSystem: item[4],
                                                    programLevel: item[5],
                                                    addYN: item[8],
                                                    saveYN: item[9],
                                                    delYN: item[10],
                                                    rtvYN: item[11],
                                                    modYN: item[12],
                                                    imgPath: item[16],
                                                }));

                                                tv_favorite.itemsSource = items;
                                            });

                                        sweetInfoAlert.fire({text: '즐겨찾기에서 삭제되었습니다.'});
                                    }
                                });
                        }
                    });
                });

                e.element.append(btn);

                var img = e.dataItem.imgPath;
                if (img == 'none') return;

                var div = document.createElement('div');
                div.classList.add('icon', img, '_collapse');

                e.element.prepend(div);
            }
        });

        tv_favorite.hostElement.classList.add('main-treeview');
        tv_favorite.itemClicked.addHandler(async (s, e) => {
            if (flag) {
                flag = false;
                return;
            }

            console.log(s.selectedItem)
            await goToPage(s.selectedItem.programID);
        });

        await fetch('/api/getFavoriteMenu')
            .then(res => res.json())
            .then(data => {
                var items = data.map(item => ({
                    header: item[3],
                    programID: item[2],
                    programSystem: item[4],
                    programLevel: item[5],
                    addYN: item[8],
                    saveYN: item[9],
                    delYN: item[10],
                    rtvYN: item[11],
                    modYN: item[12],
                    imgPath: item[16],
                }));

                tv_favorite.itemsSource = items;
            });

        var datas = [];
        await fetch('/api/get/mainCategory')
            .then(response => response.json())
            .then(data => {
                for (var item of data) {
                    datas = data;
                }
            });

        for (var item of datas) {
            AddMainCategoryMenu(item);
        }

        SortTopItems();

        var i = 0;
        for (var item of datas) {
            var temp = null;

            await fetch('/api/treeView?groupId=' +  $('#uGroup').val() + '&userId=' + $('#uId').val() + '&systemName=' + item.id)
                .then(response => response.json())
                .then(data => {
                    console.log(data);
                    var items = data.map(item => ({
                        header: item.programName /*changeLangFromStorage(item.programID) 번역하기 위함 일단 주석처리*/,
                        programID: item.programID,
                        programLevel: item.programLevel,
                        addYN: item.addYN,
                        saveYN: item.saveYN,
                        delYN: item.delYN,
                        rtvYN: item.rtvYN,
                        modYN: item.modYN,
                        imgPath: item.imgPath,
                        items: item.hasChildren ? [] : null,
                        basicProgramName: item.programName
                    }));

                    menuItems = items;

                    var id = '#tree-' + item.id;

                    temp = new wijmo.nav.TreeView(id, {
                        itemsSource: items,
                        displayMemberPath: 'header',
                        childItemsPath: 'items',
                        lazyLoadFunction: lazyLoadFunction,
                        isAnimated: false,
                        autoCollapse: false,
                        isCollapsedChanged: function (s, e) {
                            refreshIcon(s);
                        },
                        formatItem: function (s, e) {
                            var img = e.dataItem.imgPath;
                            if (img == 'none') return;

                            var div = document.createElement('div');
                            div.classList.add('icon', img, '_collapse');

                            e.element.prepend(div);
                        }
                    });

                    temp.itemClicked.addHandler((s, e) => {
                        console.log(s);
                        console.log(e);
                        onClickMenuItem(s, e);
                    });
                });

            temp.hostElement.classList.add('main-treeview');
            mainTrees.push(temp);

            // 만약 temp의 노드가 하나도 없다면
            if (temp.itemsSource.length == 0) {
                var menu = document.getElementById('menu-' + item.id);
                menu.style.display = 'none';
            }

            i++;
        }

        remarkHistoryModal = new wijmo.input.Popup('#remarkHistoryModal', {
            isDraggable: true,
            hideTrigger: 0
        });

    });

    // function mouseOverHandler() {
    //     var treeQMS = document.getElementById("tree-qms");
    //     treeQMS.style.scrollbarColor = 'white';
    // }
    //
    // function  mouseOutHandler() {
    //
    // }

    function AddMainCategoryMenu(menuData) {
        var menu = document.createElement("div");
        menu.className = "main-menu";
        menu.id = 'menu-' + menuData.id;
        menu.onclick = function () {
            toggleMenu(this.id);
        };

        var div = document.createElement('div');
        div.classList.add('icon_hover');

        menu.appendChild(div);

        var icon = menuData.icon;
        if (icon != 'none') {
            var div = document.createElement('div');
            div.classList.add('icon', icon, '_collapse');

            menu.appendChild(div);
        }


        var span = document.createElement("span");
        span.innerText = menuData.name;
        menu.appendChild(span);

        var title_div = document.createElement('div');
        if (menuData.name.length > 10) {
            title_div.classList.add('mc_title', 'scroll-text');

            var track = document.createElement('div');
            track.classList.add('track');
            track.style.animation = 'scroll-animation 5s linear infinite';

            for (var i = 0; i < 5; i++) {
                var p = document.createElement("p");
                p.innerText = menuData.name
                track.appendChild(p);
            }

            title_div.appendChild(track);
        } else {
            title_div.classList.add('mc_title');
            title_div.innerText = menuData.name;
        }

        menu.appendChild(title_div);

        var sub = document.createElement("div");
        sub.id = 'menu-' + menuData.id + '-content';
        sub.style.display = "none";
        sub.classList.add('main-menu-content');

        var treeDiv = document.createElement("div");
        treeDiv.id = 'tree-' + menuData.id;
        // treeDiv.addEventListener('mouseover', mouseOverHandler);
        // treeDiv.addEventListener('mouseout', mouseOutHandler);

        sub.appendChild(treeDiv);

        top_menu.appendChild(menu);
        top_menu.appendChild(sub);

        var data = {
            menu: menu,
            content: sub,
            order: menuData.order
        }

        main_categories.push(data);
    }

    function toggleMenu(menuId) {
        var top_menu_items = top_menu.querySelectorAll(".main-menu");
        var bottom_menu_items = bottom_menu.querySelectorAll(".main-menu");

        var sidebar = document.querySelector(".sidebar");

        if (sidebar.classList.contains("close")) {
            sidebar.classList.toggle("close");
        }

        if (currentMenu == null) {
            for (var item of top_menu_items) {
                if (item.id != menuId) {
                    bottom_menu.appendChild(item);
                    var sub = document.getElementById(item.id + "-content");
                    if (sub) {
                        sub.style.display = "none";
                        bottom_menu.appendChild(sub);
                    }
                } else {

                    var sub = document.getElementById(item.id + "-content");
                    if (sub) sub.style.display = "flex";
                    currentMenu = item;
                }
            }

            ResizeContentArea();

        } else {
            if (currentMenu.id == menuId) {
                CloseAll();
            } else {
                bottom_menu.appendChild(currentMenu);
                var sub = document.getElementById(currentMenu.id + "-content");
                if (sub) {
                    sub.style.display = "none";
                    bottom_menu.appendChild(sub);
                }

                for (var item of bottom_menu_items) {
                    if (item.id == menuId) {
                        top_menu.appendChild(item);
                        var sub = document.getElementById(item.id + "-content");
                        if (sub) {
                            sub.style.display = "flex";
                            top_menu.appendChild(sub);
                        }
                        currentMenu = item;
                    }
                }

                ResizeContentArea();
            }
        }
    }

    function CloseAll() {
        var bottom_menu_items = bottom_menu.querySelectorAll(".main-menu");

        for (var item of bottom_menu_items) {
            top_menu.appendChild(item);
            var sub = document.getElementById(item.id + "-content");
            if (sub) top_menu.appendChild(sub);
        }

        var sub = document.getElementById(currentMenu.id + "-content");
        if (sub) sub.style.display = "none";
        currentMenu = null;

        SortTopItems();
    }

    function SortTopItems() {
        for (var item of main_categories) {
            top_menu.appendChild(item.menu);
            top_menu.appendChild(item.content);

            if(sidebarClose) {
                abbreviationUse(item);
            }
        }
    }

    function abbreviationUse(item){
        let b = "#" + item.menu.id;

        if(item.menu.id != "menu-favorite"){
            fetch(`/api/get/mainCategory/abbreviation?order=${item.menu.id.slice(5)}`)
                .then(response => {
                    return response.text();
                })
                .then(data => {
                    if (data.trim() !== "" && data != null) {
                        try {
                            document.querySelector(`${b} > div.mc_title`).innerHTML = data;
                        } catch {}
                    }
                });
        }
    }


    function refreshToken() {
        fetch('/refreshToken', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: localStorage.getItem('JWT')
        })
            .then(res => res.text())
            .then(data => {
                localStorage.setItem('LOGIN_TIME', new Date().getTime());
                localStorage.setItem('IsExtend', 'false');
                localStorage.setItem('JWT', data);
                document.cookie = "JWT=" + data;
            });
    }

    async function OnClickRefresh() {
        refreshToken();
        sweetInfoAlert.fire({text: '로그인 시간이 연장되었습니다.'});
    }

    async function onClickLogout() {

        fetch('/api/insert/log', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify([
                "Logout",
                "아이디 "+$('#uId').val()+"가 정상적으로 로그아웃 했습니다."
            ])
        }).then(() => {
            localStorage.removeItem('LOGIN_TIME');
            localStorage.removeItem('IsExtend');
            localStorage.removeItem('JWT');
            document.cookie = "JWT= ; expires = Thu, 01 Jan 1970 00:00:00 GMT";
            location.href = '/logout';
        });

    }

    function getUserManual() {
        var url = "/fileApi/showManual";
        var popup = window.open(url, 'manualView', 'menubar=no, scrollbars=yes, status=yes, resizable=auto, hotkey=0, width=1500, height=800, left=200, top=200');
    }
</script>

<script>
    var sidebar = document.querySelector(".sidebar");
    var toggle = document.querySelector(".toggle");
    var home = document.querySelector(".home");
    let a = 1;

    toggle.addEventListener("click", () => {
        sidebar.style.width = '';
        sidebar.classList.toggle("close");

        if(a == 1){
            sidebarClose = false; //열림
            a = 0;
        } else {
            sidebarClose = true;  //닫힘
            a = 1;
        }

        home.style.left = '';
        home.style.width = '';

        CloseAll();

        for (var tree of mainTrees) {
            tree.collapseToLevel(0);
        }

        SortTopItems();
    });

    var resizer = document.querySelector(".sidebar-resize");

    var x = 0;
    var width = 0;

    var onMouseDown = function(e) {
        x = e.clientX;

        width = sidebar.getBoundingClientRect().width;
        if (sidebar.classList.contains("close")) {
            sidebar.classList.toggle("close");
        }

        var bodyWidth = document.body.getBoundingClientRect().width;
        var newWidth = (width * 100) / bodyWidth;

        sidebar.style.width = newWidth + '%';
        home.style.left = newWidth + '%';
        home.style.width = (100 - newWidth) + '%';

        document.addEventListener('mousemove', onMouseMove);
        document.addEventListener('mouseup', onMouseUp);
    };

    var onMouseMove = function(e) {
        var dx = e.clientX - x;

        document.body.style.cursor = 'col-resize';

        sidebar.style.userSelect = 'none';
        sidebar.style.pointerEvents = 'none';

        home.style.userSelect = 'none';
        home.style.pointerEvents = 'none';

        var bodyWidth = document.body.getBoundingClientRect().width;
        var newWidth = ((width + dx) * 100) / bodyWidth;

        sidebar.style.width = newWidth + '%';
        home.style.left = newWidth + '%';
        home.style.width = (100 - newWidth) + '%';
    };

    var onMouseUp = function(e) {
        resizer.style.removeProperty('cursor');
        document.body.style.removeProperty('cursor');

        sidebar.style.removeProperty('user-select');
        sidebar.style.removeProperty('pointer-events');

        home.style.removeProperty('user-select');
        home.style.removeProperty('pointer-events');

        document.removeEventListener('mousemove', onMouseMove);
        document.removeEventListener('mouseup', onMouseUp);
    };

    resizer.addEventListener('mousedown', onMouseDown);

    var notifyHeader = document.querySelector('.notify-header');
    var notifyList = document.querySelector('.notify-list');
    var toast_container = document.querySelector('.toast-container');
    var notify_btn = document.querySelector('.notify-btn');

    var startY = 0;
    var startHeight = 0;
    var toast_container_height = 0;
    var notify_btn_height = 0;

    notifyHeader.addEventListener('mousedown', function(e) {
        startY = e.clientY;
        startHeight = notifyList.offsetHeight;
        toast_container_height = toast_container.offsetHeight;
        notify_btn_height = notify_btn.style.bottom;
        notify_btn_height = Number(notify_btn_height.substring(0, notify_btn_height.length - 2));

        document.documentElement.addEventListener('mousemove', onMouseMove1);
        document.documentElement.addEventListener('mouseup', onMouseUp1);

        e.preventDefault();
    });

    function onMouseMove1(e) {
        var dy = startY - e.clientY;
        notifyList.style.height = `${startHeight + dy}px`;
        notifyList.style.maxHeight = '100%';
        toast_container.style.height = `${toast_container_height + dy}px`;
        notify_btn.style.bottom = `${notify_btn_height + dy}px`;
    }


    function onMouseUp1() {
        document.documentElement.removeEventListener('mousemove', onMouseMove1);
        document.documentElement.removeEventListener('mouseup', onMouseUp1);
    }

    function initCheckBoxes(sTblId)
    {
        xTableIterate(sTblId,
            function(td, isRow) {
                if (!isRow) {
                    var cb = td.getElementsByTagName('input');
                    if (cb && cb[0].type.toLowerCase() == 'checkbox') {
                        td.checkBoxObj = cb[0];
                        td.onmousedown = tdOnMouseDown;
                        td.onmouseover = tdOnMouseOver;
                        td.onclick = tdOnClick;
                    }
                }
            }
        );
    }

    function tdOnMouseDown(ev)
    {
        if (this.checkBoxObj) {
            gCheckedValue = this.checkBoxObj.checked = !this.checkBoxObj.checked;
            document.onmouseup = docOnMouseUp;
            // document.onselectstart = docOnSelectStart; // for IE
            xPreventDefault(ev); // cancel text selection
        }
    }
    function tdOnMouseOver(ev)
    {
        if (gCheckedValue != null && this.checkBoxObj) {
            this.checkBoxObj.checked = gCheckedValue;
        }
    }
    function docOnMouseUp()
    {
        document.onmouseup = null;
        document.onselectstart = null;
        gCheckedValue = null;
    }
    function tdOnClick()
    {
        // Cancel a click on the checkbox itself. Let it bubble up to the TD
        return false;
    }

    function xGetElementById(e)
    {
        if(typeof(e)=='string') {
            if(document.getElementById) e=document.getElementById(e);
            else if(document.all) e=document.all[e];
            else e=null;
        }
        return e;
    }
    function xTableIterate(sec, fnCallback, data)
    {
        var r, c;
        sec = xGetElementById(sec);
        if (!sec || !fnCallback) { return; }
        for (r = 0; r < sec.children.length; ++r) {
            if (false == fnCallback(sec.children[r], true, r, c, data)) { return; }
            if (false == fnCallback(sec.children[r], false, r, c, data)) { return; }
        }
    }

    function xPreventDefault(e)
    {
        if (e && e.preventDefault) e.preventDefault();
        else if (window.event) window.event.returnValue = false;
    }

    function selectCellByValidation(grid,rowIndex,header) {
        for(var j=0; j<grid.columns.length; j++){
            if(grid.columns[j].header == header){
                grid.select(rowIndex,j);
                setTimeout(() => {grid.startEditing()},300);
            }
        }
    }

    function basicNonConformityPopupHide(){
        basicNonConformityPopup.hide();
    }

    function requestPopupHide(){
        requestPopup.hide();
    }

    function requestPopupAdd(){

        var settingList = wijmo.Control.getControl("#requestPopupSettingList");
        var addedList = wijmo.Control.getControl("#requestPopupAddedList");
        var selected = settingList.selectedItems;
        for(var i=0;i<selected.length;i++){
            var entity = selected[i].inspectionItem;
            var item = selected[i].basicName;
            var newRow = {"item": item, "entity":entity};
            settingList.collectionView.remove(selected[i]);
            addedList.collectionView.addNew(newRow);
        }
    }

    //제거하기
    function requestPopupDelete(){
        var settingList = wijmo.Control.getControl("#requestPopupSettingList");
        var addedList = wijmo.Control.getControl("#requestPopupAddedList");
        var selected = addedList.selectedItems;
        for(var i=0;i<selected.length;i++){
            var inspectionItem = selected[i].entity;
            var basicName = selected[i].item;
            var newRow = {"inspectionItem": inspectionItem, "basicName":basicName};
            addedList.collectionView.remove(selected[i]);
            settingList.collectionView.addNew(newRow);
        }
    }

    function requestPopupReset() {
        var param = {
            "division" : $('input[name=division]').val(),
            "process" : $('input[name=process]').val(),
            "name" : $('input[name=rawMatName]').val()
        };
        fetch('/rawRequest/rawRequestDialogReloadSettingData', {
            method: 'post',
            headers: {
                "Content-Type": "application/json"
            },
            body: JSON.stringify(param)
        })
            .then(response => response.json())
            .then((data) => {
                wijmo.Control.getControl("#requestPopupSettingList").itemsSource = data;
            });
        fetch('/rawRequest/rawRequestDialogReloadAddedData', {
            method: 'post',
            headers: {
                "Content-Type": "application/json"
            },
            body: JSON.stringify(param)
        })
            .then(response => response.json())
            .then((data) => {
                wijmo.Control.getControl("#requestPopupAddedList").itemsSource = data;
            });
    }

    function requestPopupSave(){
        var grid =  wijmo.Control.getControl("#requestPopupAddedList");
        grid.collectionView.commitEdit();
        grid.finishEditing();
        var addedItemSourceList = wijmo.Control.getControl("#requestPopupAddedList").itemsSource;
        for (var i = 0; i < addedItemSourceList.length; i++) {
            var item = addedItemSourceList[i];

            if (item.unit === undefined || item.unit === null || item.unit === "") {
                requestPopup.hide();
                sweetInfoAlert.fire({text: (i + 1) + " 행의 단위가 입력되지 않았습니다."})
                    .then(() => {
                        requestPopup.show();
                        for(var j=0; j< grid.columns.length; j++){
                            if(grid.columns[j].header == '단위'){
                                grid.select(i,j);
                                setTimeout(() => {grid.startEditing()},300);
                            }
                        }
                    });
                return;
            }
            if (item.ucl === undefined || item.ucl === null || item.ucl === "") {
                requestPopup.hide();
                sweetInfoAlert.fire({text: (i + 1) + " 행의 UCL이 입력되지 않았습니다."})
                    .then(() => {
                        requestPopup.show();
                        for(var j=0; j< grid.columns.length; j++){
                            if(grid.columns[j].header == 'UCL'){
                                grid.select(i,j);
                                setTimeout(() => {grid.startEditing()},300);
                            }
                        }
                    });
                return;
            }
            if (item.lcl === undefined || item.lcl === null || item.lcl === "") {
                requestPopup.hide();
                sweetInfoAlert.fire({text: (i + 1) + " 행의 LCL이 입력되지 않았습니다."})
                    .then(() => {
                        requestPopup.show();
                        for(var j=0; j< grid.columns.length; j++){
                            if(grid.columns[j].header == 'LCL'){
                                grid.select(i,j);
                                setTimeout(() => {grid.startEditing()},300);
                            }
                        }
                    });
                return;
            }
            if (item.usl === undefined || item.usl === null || item.usl === "") {
                requestPopup.hide();
                sweetInfoAlert.fire({text: (i + 1) + " 행의 USL이 입력되지 않았습니다."})
                    .then(() => {
                        requestPopup.show();
                        for(var j=0; j< grid.columns.length; j++){
                            if(grid.columns[j].header == 'USL'){
                                grid.select(i,j);
                                setTimeout(() => {grid.startEditing()},300);
                            }
                        }
                    });
                return;
            }

            if (item.lsl === undefined || item.lsl === null || item.lsl === "") {
                requestPopup.hide();
                sweetInfoAlert.fire({text: (i + 1) + " 행의 LSL이 입력되지 않았습니다."})
                    .then(() => {
                        requestPopup.show();
                        for(var j=0; j< grid.columns.length; j++){
                            if(grid.columns[j].header == 'LSL'){
                                grid.select(i,j);
                                setTimeout(() => {grid.startEditing()},300);
                            }
                        }
                    });
                return;
            }

            var flsl = parseFloat(item.lsl);
            var flcl = parseFloat(item.lcl);
            var fucl = parseFloat(item.ucl);
            var fusl = parseFloat(item.usl);

            if (flsl > fusl) {
                requestPopup.hide();
                sweetInfoAlert.fire({text: "LSL이 USL보다 클 수 없습니다."}).then(() => {
                    requestPopup.show();
                });
                return;
            }
            if (flsl > flcl) {
                requestPopup.hide();
                sweetInfoAlert.fire({text: "LSL이 LCL보다 클 수 없습니다."}).then(() => {
                    requestPopup.show();
                });
                return;
            }
            if (flsl > fucl) {
                requestPopup.hide();
                sweetInfoAlert.fire({text: "LSL이 UCL보다 클 수 없습니다."}).then(() => {
                    requestPopup.show();
                });
                return;
            }
            if (fucl > fusl) {
                requestPopup.hide();
                sweetInfoAlert.fire({text: "UCL이 USL보다 클 수 없습니다."}).then(() => {
                    requestPopup.show();
                });
                return;
            }
            if (flcl > fusl) {
                requestPopup.hide();
                sweetInfoAlert.fire({text: "LCL이 USL보다 클 수 없습니다."}).then(() => {
                    requestPopup.show();
                });
                return;
            }
            if (flcl > fucl) {
                requestPopup.hide();
                sweetInfoAlert.fire({text: "LCL이 UCL보다 클 수 없습니다."}).then(() => {
                    requestPopup.show();
                });
                return;
            }

        }

        var gridId = "";
        var analysisProgressGrid = "";

        switch($('input[name=division]').val()){
            case "원재료":
                gridId = "rawRequestList";
                analysisProgressGrid = "rawRequestReport";
                break;
            case "제품":
                gridId = "productRequestList";
                analysisProgressGrid = "productRequestReport"
                break;
            case "샘플및기타":
                gridId = "otherRequestList";
                analysisProgressGrid = "otherRequestReport"
                break;
        }
        wijmo.Control.getControl("#"+gridId).itemsSource.currentItem.requestItem = '입력완료';
        wijmo.Control.getControl("#"+gridId).collectionView.commitEdit();
        wijmo.Control.getControl("#"+gridId).collectionView.commitNew();

        var param = {
            "division": $('input[name=division]').val(),
            "lotNo": $('input[name=lotNo]').val(),
            "requestDivision": $('input[name=requestDivision]').val(),
            "process": $('input[name=process]').val(),
            "userId": $('input[name=uId]').val()
        };

        var items = [];

        for(var i=0; i<addedItemSourceList.length;i++){
            var added = addedItemSourceList[i];
            var item = {};
            item.dataIdx = i;
            item.division = $('input[name=division]').val()
            item.lotNo = $('input[name=lotNo]').val()
            item.process = $('input[name=process]').val()
            item.managementTopic = added.entity;
            item.item = added.item;
            item.unit = added.unit;
            item.ucl = Number(added.ucl);
            item.lcl = Number(added.lcl);
            item.usl = Number(added.usl);
            item.lsl = Number(added.lsl);
            item.requestDivision = $('input[name=requestDivision]').val();
            item.requester = $('input[name=uName]').val();
            item.requestDate = commonGetDate();
            item.requestTime = getTime();
            item.amendDate = getDate();
            item.registerDate = getDate();
            item.registerEmp = $('input[name=uName]').val();
            items.push(item);
        }

        sessionStorage.setItem($('input[name=lotNo]').val(),JSON.stringify(items))

        var requestReportgrid = wijmo.Control.getControl('#' + analysisProgressGrid);
        requestReportgrid.itemsSource = items;

        requestReportgrid.autoSizeColumn();

        sweetInfoAlert.fire({text: "저장되었습니다."});
        requestPopup.hide();

        /*$.ajax({
            url: '/rawRequest/rawRequestDialogSave',
            type: 'POST',
            headers: {
                "Content-Type": "application/json",
            },
            data: JSON.stringify(requestParamList)
        }).done(
            function (data) {
                var gridId = "";
                var analysisProgressGrid = "";

                switch($('input[name=division]').val()){
                    case "원재료":
                        gridId = "rawRequestList";
                        analysisProgressGrid = "rawRequestReport";
                        break;
                    case "제품":
                        gridId = "productRequestList";
                        analysisProgressGrid = "productRequestReport"
                        break;
                    case "샘플및기타":
                        gridId = "otherRequestList";
                        analysisProgressGrid = "otherRequestReport"
                        break;
                }
                wijmo.Control.getControl("#"+gridId).itemsSource.currentItem.requestItem = '입력완료';
                wijmo.Control.getControl("#"+gridId).collectionView.commitNew()

                var requestReportgrid = wijmo.Control.getControl('#' + analysisProgressGrid);
                requestReportgrid.itemsSource = data.map(item => ({
                    managementTopic: item.managementTopic,
                    item: item.item,
                    unit: item.unit,
                    ucl: Number(item.ucl),
                    lcl: Number(item.lcl),
                    usl: Number(item.usl),
                    lsl: Number(item.lsl),
                    itemValue: item.itemValue === "" ? '' : item.itemValue == null ? '' : isNaN(item.itemValue) ? item.itemValue : Number(item.itemValue),
                    passfailGB: item.passfailGB,
                    remark: item.remark,
                    file: item.file,
                    requestDivision: item.requestDivision,
                    requester: item.requester,
                    requestDate: item.requestDate,
                    requestTime: item.requestTime,
                    recipent: item.recipent,
                    receivedDate: item.receivedDate,
                    receivedTime: item.receivedTime,
                    analyst: item.analyst,
                    analysisDate: item.analysisDate,
                    analysisTime: item.analysisTime,
                    amendDate: item.amendDate,
                    registerDate: item.registerDate

                }));

                requestReportgrid.autoSizeColumn();

                sweetInfoAlert.fire({text: "저장되었습니다."});
                requestPopup.hide();

            })

            .fail((jqXHR, errorMsg) => {
                sweetInfoAlert.fire({text: '저장 실패했습니다.'});
            });*/
    }

    function initRequestPopupFunc(division,lotNo,requestDivision,process,name){
        $('input[name=division]').val(division);
        $('input[name=lotNo]').val(lotNo);
        $('input[name=requestDivision]').val(requestDivision);
        $('input[name=process]').val(process);
        $('input[name=rawMatName]').val(name);
        var grid = wijmo.Control.getControl('#requestPopupAddedList');
        var param = {
            "division" : division,
            "lotNo" : lotNo,
            "requestDivision" : requestDivision,
            "process" : process,
            "name" : name
        };
        fetch('/rawRequest/getRequestDialogData1', {
            method: 'post',
            headers: {
                "Content-Type": "application/json"
            },
            body: JSON.stringify(param)
        }).then(response => response.json())
            .then((data) => {

                if(sessionStorage.getItem(lotNo)){
                    var itemList = JSON.parse(sessionStorage.getItem(lotNo));
                    itemList.map(item => {
                        item.entity = item.managementTopic;
                    });
                    data = itemList;
                }

                if(grid){
                    grid.itemsSource = data;
                }else {
                    grid = new wijmo.grid.FlexGrid('#requestPopupAddedList', {
                        selectionMode: 'MultiRange',
                        itemsSource: data,
                        isReadOnly: false,
                        autoGenerateColumns: false,
                        keyActionTab: 3,
                        imeEnabled: true,
                        columns: [
                            {binding: 'entity', header: '검사항목', align: 'center'},
                            {binding: 'item', header: '관리항목', align: 'center'},
                            {binding: 'unit', header: '단위', align: 'center'},
                            {binding: 'ucl', header: 'UCL', align: 'center', format : 'g24'},
                            {binding: 'lcl', header: 'LCL', align: 'center', format : 'g24'},
                            {binding: 'usl', header: 'USL', align: 'center', format : 'g24'},
                            {binding: 'lsl', header: 'LSL', align: 'center', format : 'g24'},
                        ],
                        updatedView: (s,e)=> {
                            s.focus();
                        },
                        cellEditEnded: function(s, e) {
                            var col = e.panel.columns[e.col];
                            if (col.binding === 'ucl' || col.binding === 'lcl' || col.binding === 'usl' || col.binding === 'lsl') {
                                var item = s.rows[e.row].dataItem[col.binding];
                                console.log(item)
                                if (item) {
                                    if (typeof item === 'string') { // item[binding]이 문자열인지 확인
                                        item = parseFloat(item.replace(/[^0-9.]/g, ''));
                                        s.setCellData(e.row,col.binding,item);
                                    }
                                }
                            }
                        },
                        pastedCell: function(s, e) {
                            var col = e.panel.columns[e.col];
                            if (col.binding === 'ucl' || col.binding === 'lcl' || col.binding === 'usl' || col.binding === 'lsl') {
                                var item = s.rows[e.row].dataItem[col.binding];
                                console.log(item)
                                if (item) {
                                    if (typeof item === 'string') { // item[binding]이 문자열인지 확인
                                        item = parseFloat(item.replace(/[^0-9.]/g, ''));
                                        s.setCellData(e.row,col.binding,item);
                                    }
                                }
                            }
                        },
                        formatItem: function(s, e) {
                            if (e.panel == s.cells) {

                                var col = e.panel.columns[e.col];
                                if (col.binding === 'item') {
                                    var item = s.rows[e.row].dataItem['passFail'];
                                    if (item == '불합격') {
                                        wijmo.addClass(e.cell, 'red-cell');
                                    }else if (item == '관리선이탈') {
                                        wijmo.addClass(e.cell, 'yellow-cell');
                                    }
                                }

                            }
                        },

                    });
                    grid.beginningEdit.addHandler(function (s, e) {
                        const header = s.columns[e.col].header;
                        if (header == '검사항목' || header == '관리항목') {
                            e.cancel = true;
                        }
                    })
                    grid.hostElement.addEventListener('keydown', (e) => {
                        if(e.keyCode == 13 || e.keyCode == 32){
                            requestPopupSave();
                        }
                    }, true);
                }
            });

        var grid2 = wijmo.Control.getControl('#requestPopupSettingList');

        fetch('/rawRequest/getRequestDialogData2', {
            method: 'post',
            headers: {
                "Content-Type": "application/json"
            },
            body: JSON.stringify(param)
        }).then(response => response.json())
            .then((data) => {

                if(grid2){
                    grid2.itemsSource = data;
                }else {
                    grid2 = new wijmo.grid.FlexGrid('#requestPopupSettingList', {
                        selectionMode: 'MultiRange',
                        itemsSource: data,
                        isReadOnly: true,
                        autoGenerateColumns: false,
                        keyActionTab: 3,
                        imeEnabled: true,
                        columns: [
                            {binding: 'inspectionItem', header: '검사항목', align: 'center'},
                            {binding: 'basicName', header: '관리항목', align: 'center'}
                        ]
                    });
                }
            })

    }

    function initBasicNonConformityPopupFunc(lotNo,requestDivision,process,rawMatName,requestPurpose){

        $('#nonConformityPopupLotNo').val(lotNo);
        $('#nonConformityPopupName').val(rawMatName);
        $('#basicNonConformityPopupRequestDivision').val(requestDivision);
        $('#basicNonConformityPopupProcess').val(process);
        $('#nonConformityPopupRequestPurpose').val(requestPurpose);

        let param = [];

        if(process == "IQC"){
            param = {
                "division": "원재료",
                "lotNo" : lotNo,
                "requestDivision" : requestDivision,
                "process" : process
            }
        }
        else if(process == "기타" || process == "평가샘플") {
            param = {
                "division": "샘플및기타",
                "lotNo" : lotNo,
                "requestDivision" : requestDivision,
                "process" : process
            }
        }else{
            param = {
                "division": "제품",
                "lotNo" : lotNo,
                "requestDivision" : requestDivision,
                "process" : process
            }
        }

        var basicNonConformityPopupGrid = wijmo.Control.getControl("#basicNonConformityPopupGrid");
        fetch('/rawNon/testItemGrid', {
            method: 'post',
            headers: {
                "Content-Type": "application/json"
            },
            body: JSON.stringify(param)
        }).then(response => response.json())
            .then((data) => {
                for (var i = 0; i < data.length; i++) {
                    data[i].usl = data[i].usl == null ? "" : Number(data[i].usl);
                    data[i].lsl = data[i].lsl == null ? "" : Number(data[i].lsl);
                    data[i].ucl = data[i].ucl == null ? "" : Number(data[i].ucl);
                    data[i].lcl = data[i].lcl == null ? "" : Number(data[i].lcl);
                    data[i].itemValue = data[i].itemValue == null ? "" : isNaN(data[i].itemValue) ? data[i].itemValue : Number(data[i].itemValue);
                }

                console.log(data);
                if(basicNonConformityPopupGrid){
                    basicNonConformityPopupGrid.itemsSource = data;
                }else {
                    basicNonConformityPopupGrid = new wijmo.grid.FlexGrid('#basicNonConformityPopupGrid', {
                        selectionMode: 'MultiRange',
                        itemsSource: data,
                        isReadOnly: true,
                        newRowAtTop: true,
                        autoGenerateColumns: false,
                        keyActionTab: 3,
                        imeEnabled: true,
                        columns: [
                            {binding: 'managementTopic', header: '검사항목', align: 'center', width: 80},
                            {binding: 'item', header: '관리항목', align: 'center' ,width: 80},
                            {binding: 'unit', header: '단위', align: 'center', width: 80},
                            SetDecimalPoint({binding: 'ucl', header: 'UCL', align: 'center', width: 80}),
                            SetDecimalPoint({binding: 'lcl', header: 'LCL', align: 'center', width: 80}),
                            SetDecimalPoint({binding: 'usl', header: 'USL', align: 'center', width: 80}),
                            SetDecimalPoint({binding: 'lsl', header: 'LSL', align: 'center', width: 80}),
                            SetDecimalPoint({binding: 'itemValue', header: '측정값', align: 'center', width: 80}, Boolean(Number(option.decimalValid))),
                            {binding: 'passfailGB', header: '합부여부', align: 'center', width: 80},
                            {binding: 'remark', header: '비고', align: 'center', width: 80},
                            {binding: 'file', header: '파일', align: 'center', width: 80}, //드럼수 이후에 원래 입고성적서
                            {binding: 'requestDivision', header: '의뢰구분', align: 'center', width: 80},
                            {binding: 'requester', header: '의뢰자', align: 'center', width: 80},
                            {binding: 'requestDate', header: '의뢰일자', align: 'center', width: 80},
                            {binding: 'receivedTime', header: '의뢰시간', align: 'center', width: 80},
                            {binding: 'requester', header: '접수자', align: 'center', width: 80},
                            {binding: 'requestDate', header: '접수일자', align: 'center', width: 80},
                            {binding: 'receivedTime', header: '접수시간', align: 'center', width: 80},
                            {binding: 'recipient', header: '분석자', align: 'center', width: 80},
                            {binding: 'analysisDate', header: '분석일자', align: 'center', width: 80},
                            {binding: 'analysisTime', header: '분석시간', align: 'center', width: 80},
                            {binding: 'registerDate', header: '등록일', align: 'center', width: 80},
                            {binding: 'amendDate', header: '수정일', align: 'center', width: 80}
                        ],

                    })
                    basicNonConformityPopupGrid.formatItem.addHandler(function (s, e) {
                        if (e.panel == s.cells) {
                            var col = s.columns[e.col];
                            var item = s.getCellData(e.row, e.col);
                            if (col.binding === 'passfailGB') {
                                if (item == '불합격') {
                                    console.log(e.cell);
                                    wijmo.addClass(e.cell, 'red-cell');
                                }
                                if (item == '관리선이탈') {
                                    wijmo.addClass(e.cell, 'yellow-cell');
                                }
                            }
                        }
                    });

                    //파일 클릭시 업,다운,삭제 context Menu
                    let host = basicNonConformityPopupGrid.hostElement, menu = buildMenu(basicNonConformityPopupGrid);
                    function buildMenu(basicNonConformityPopupGrid) {
                        let menu = new wijmo.input.Menu(document.createElement('div'), {
                            owner: basicNonConformityPopupGrid.hostElement,
                            displayMemberPath: 'header',
                            subItemsPath: 'items',
                            commandParameterPath: 'cmd',
                            closeOnLeave: true,
                            itemsSource: [
                                {header: '파일 업로드', cmd: 'upload'},
                                {header: '-'},
                                {header: '파일 다운로드', cmd: 'download'},
                                {header: '-'},
                                {header: '파일 삭제', cmd: 'delete'},
                            ],
                            command: {
                                canExecuteCommand: (cmd) => {
                                    switch (cmd) {
                                        case 'upload':
                                            return basicNonConformityPopupGrid.rows[basicNonConformityPopupGrid.selection.row].dataItem['file'] != true;
                                        case 'download':
                                            return basicNonConformityPopupGrid.rows[basicNonConformityPopupGrid.selection.row].dataItem['file'] == true;
                                        case 'delete':
                                            return basicNonConformityPopupGrid.rows[basicNonConformityPopupGrid.selection.row].dataItem['file'] == true;
                                    }
                                    return true;
                                },
                                // execute menu commands
                                executeCommand: (cmd) => {
                                    let view = basicNonConformityPopupGrid.collectionView, cols = basicNonConformityPopupGrid.columns,
                                        col = cols[basicNonConformityPopupGrid.selection.col], sd = view.sortDescriptions,
                                        gd = view.groupDescriptions;
                                    switch (cmd) {
                                        case 'upload': fileUpload(); break;
                                        case 'download': fileDownload(); break;
                                        case 'delete': fileDelete(); break;
                                    }
                                    // restore focus to active grid cell
                                    basicNonConformityPopupGrid.refresh();
                                    let sel = basicNonConformityPopupGrid.selection, cell = basicNonConformityPopupGrid.cells.getCellElement(sel.row, sel.col);
                                    if (cell) {
                                        cell.focus();
                                    }
                                }
                            }
                        });

                        //contextMenu click function
                        host.addEventListener('contextmenu', (e) => {
                            let sel = basicNonConformityPopupGrid.selection, ht = basicNonConformityPopupGrid.hitTest(e);
                            if(basicNonConformityPopupGrid.columns[ht.col].header == '파일'){
                                switch (ht.panel) {
                                    case basicNonConformityPopupGrid.cells:
                                        let colIndex = ht.col;
                                        // if this is a group header, select the group column
                                        basicNonConformityPopupGrid.select(ht.row, colIndex);
                                        break;
                                    case grid.columnHeaders:
                                        basicNonConformityPopupGrid.select(sel.row, ht.col);
                                        break;
                                    case basicNonConformityPopupGrid.rowHeaders:
                                        basicNonConformityPopupGrid.select(ht.row, sel.col);
                                        break;
                                    default:
                                        return; // invalid panel
                                }
                                // show the menu for the current column
                                if (basicNonConformityPopupGrid.selection.col > -1) {
                                    e.preventDefault(); // cancel the browser's default menu
                                    menu.show(e); // and show ours
                                }
                            }

                        }, true);
                    }
                }


            })
    }

</script>

<div id="loading" style="display: none">
    <div class="overlay"></div>
    <div class="spinner">
        <img src="images/RamtechLogo2.png" alt="RamtechLogo">
        <div class="spinner-sector spinner-sector-red"></div>
        <div class="spinner-sector spinner-sector-blue"></div>
        <div class="spinner-sector spinner-sector-green"></div>
    </div>
</div>
<div id="requestFileUploadModal" style="display: none">
    <div class="modal-header" style="justify-content: space-between;">
        <h5 class="modal-title" style="font-weight: bold;margin: 5px 0;font-size: 30px;">파일 업로드</h5>
    </div>
    <div class="modal-body">
        <input type="file" class="form-control" style="width: 250px;" id="requestFile" accept="application/vnd.openxmlformats-officedocument.spreadsheetml.sheet" />
    </div>
    <div class="modal-footer">
        <button type="button" class="btn wj-hide-ok">업로드</button>
        <button type="button" class="btn wj-hide">취소</button>
    </div>
</div>

<div id="remarkHistoryModal">
    <div class="modal-header" style="justify-content: space-between;">
        <h5 class="modal-title" style="font-weight: bold;margin: 5px 0;">비고 히스토리</h5>
        <button type="button" class="btn-close" onclick="remarkHistoryModalHide()"></button>
    </div>
    <div class="modal-body">
        <div id="remarkHistoryGrid" style="height: 400px;"></div>
    </div>
    <div class="modal-footer">
        <button type="button" class="btnSave" style="width: 100%;" onclick="remarkHistoryModalHide()">닫기</button>
    </div>
</div>

</body>
</html>
